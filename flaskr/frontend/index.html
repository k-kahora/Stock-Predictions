<html>
<header>
    <title>Test page</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</header>

<body>
    <div>This is simple test to get data from a backend</div>
    <div><span>Last update: </span><span id="time-container"></span></div>
    <button onclick="getUsers()">Get user data</button>
    <button onclick="makeGraph()">Print Graph</button>
    <div id="result-container"></div>

</body>


<script>
    var xhr = null;
  

    getXmlHttpRequestObject = function () {
        if (!xhr) {
            // Create a new XMLHttpRequest object 
            xhr = new XMLHttpRequest();
        }
        return xhr;
    };

    function dataCallback() {
        // Check response is ready or not
        if (xhr.readyState == 4 && xhr.status == 200) {
            console.log("User data received!");
            getDate();
            dataDiv = document.getElementById('result-container');
            // Set current data text
            dataDiv.innerHTML = xhr.responseText;
        }
    }
    function getUsers() {
        console.log("Get users...");
        xhr = getXmlHttpRequestObject();
        xhr.onreadystatechange = dataCallback;
        // asynchronous requests
        xhr.open("GET", "http://localhost:5000/predict/JNJ", true);
        // Send the request over the network


        xhr.send(null);
    }
    function getDate() {
        date = new Date().toString();

        document.getElementById('time-container').textContent
            = date;
    }
  
    (function () {
        getDate();
    })();

    function makeGraph() {
	//     console.log("hres")   

	// console.log(d3.max([4321,321,43214321]))
	var width = 1000
	var height = 400 

	d3.json("http://localhost:5000/predict/JNJ").then(data => {
	    var svg = d3.select("body")
		.append("svg")
	        .attr("width", width)
	        .attr("height", height)

	    var x_axis = svg.select("g")
		.append("g")
		.attr("transform", "translate(0," + height + ")")

	    var x_scale =
	    
	    console.log(data) 

	var x = d3.scaleTime()
	    .domain(d3.extent(data, function(d) { return d.date; }))
	    .range([ 0, width ]);
	    .call(d3.axisBottom(x));

    // Add Y axis
	var y = d3.scaleLinear()
	    .domain([0, d3.max(data, function(d) { return +d.open; })])
	    .range([ height, 0 ]);
	svg.append("g")
	    .call(d3.axisLeft(y));

	// Add the line
	svg.append("path")
	    .datum(data)
	    .attr("fill", "none")
	    .attr("stroke", "steelblue")
	    .attr("stroke-width", 1.5)
	    .attr("d", d3.line()
		  .x(function(d) { return x(d.date) })
		  .y(function(d) { return y(d.open) })
		 )

	})
    }

</script>
</html>
